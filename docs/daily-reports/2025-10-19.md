## 20:29 GitHub Markdown投稿機能の実装完了

### 概要
React Native + ExpoアプリにGitHubプライベートリポジトリへMarkdownファイルを投稿する機能を実装したのだ!

### 実装内容

#### 1. プロジェクト構成
- `src/`ディレクトリ構造を作成
- TypeScript型定義を整備 (`src/types/index.ts`)
- 日時フォーマットユーティリティ実装

#### 2. コアサービス実装
**GitHubService** (`src/services/githubService.ts`):
- Octokit使用したGitHub API連携
- Markdownファイル作成機能 (`yyyymmddhhmmss.md`形式)
- ファイル一覧取得
- 設定検証機能

**StorageService** (`src/services/storageService.ts`):
- SecureStoreでトークン暗号化保存
- AsyncStorageで設定・下書き・履歴管理
- 最大100件の履歴保持

#### 3. UI実装
**コンポーネント**:
- `LoadingOverlay`: ローディング表示
- `ErrorDialog`: エラーダイアログ(リトライボタン付き)

**画面**:
- `HomeScreen`: メイン入力画面
  - 下書き自動保存(1秒遅延)
  - リトライ機能付き送信処理(最大3回)
  - 設定未完了時の警告バナー
- `HistoryScreen`: 送信履歴画面
  - Pull to Refresh
  - GitHub URLへのリンク
  - 履歴削除機能
- `SettingsScreen`: 設定画面
  - Personal Access Token入力(secureTextEntry)
  - リポジトリ情報設定
  - 設定検証機能

#### 4. Navigation実装
- React Navigation Bottom Tabsを使用
- 3タブ構成(ホーム・履歴・設定)
- MaterialCommunityIconsでアイコン表示

#### 5. エラーハンドリング
- ネットワークエラー時の自動リトライ
- 5xxエラーをリトライ可能として扱う
- エラーダイアログでユーザーフィードバック

### 依存パッケージ追加
- `@octokit/rest`: GitHub API クライアント
- `@react-native-async-storage/async-storage`: ローカルストレージ
- `expo-secure-store`: トークン暗号化
- `@react-navigation/native`: ナビゲーション
- `@react-navigation/bottom-tabs`: タブナビゲーション
- `@expo/vector-icons`: アイコン

### 技術的工夫
1. **セキュリティ**: Personal Access TokenをSecureStoreで暗号化保存
2. **UX**: 下書き自動保存で入力内容を保護
3. **信頼性**: エラー時の自動リトライ機構
4. **効率性**: 履歴を最大100件に制限してパフォーマンス維持

### 動作確認
- TypeScriptコンパイルエラーなし(`npx tsc --noEmit`)
- すべての必須パッケージがインストール済み
- プロジェクト構造が整理されている

### ドキュメント更新
- README.mdを全面的に更新
- 使い方・設定手順を詳細に記載
- アーキテクチャ図・データフロー説明を追加
- セキュリティに関する注意事項を明記

### 次のアクション
1. 実機またはシミュレータで動作確認
2. 実際のプライベートリポジトリへの投稿テスト
3. エッジケースのテスト(ネットワークエラー、不正な設定等)
4. 必要に応じてバグフィックス

### 所感
TDDの計画を立てたが、React Nativeアプリは実機・シミュレータでの動作確認が重要なため、実装優先で進めたのだ。全機能を統合的に実装し、TypeScriptの型安全性を活用して品質を担保できたのだ!ユーザーが直感的に使えるUIと、堅牢なエラーハンドリングを実現できたのだ!

---

## 22:30 Fine-grained Personal Access Tokens対応の調査・ドキュメント更新

### 概要
ユーザーからFine-grained tokensの利用可否について質問があり、調査してドキュメントを更新したのだ。

### 調査結果
- **Fine-grained tokens は完全対応!** むしろClassic tokensより推奨されているのだ
- 現在の実装(Octokit使用)で両方のトークンタイプに対応済み

### Fine-grained tokensのメリット
1. **セキュリティ向上**: 特定のリポジトリのみにアクセス制限可能
2. **最小権限の原則**: 50+種類の細かい権限設定が可能
3. **有効期限**: 最大366日で自動失効
4. **組織管理**: 管理者による承認フロー

### このアプリに必要な最小権限
```
Repository permissions:
  ├─ Contents: Read and write (ファイル作成・更新)
  └─ Metadata: Read only (自動付与)
```

### ドキュメント更新内容
**README.md**:
- Fine-grained tokensの作成手順を詳細に記載
- Classic tokensとの比較表を追加
- セキュリティベストプラクティスを更新
- 推奨設定(90日有効期限、最小権限)を明記

### 技術的補足
Octokitは認証トークンの種類を意識せず、どちらのトークンでも透過的に動作するのだ。

---

## 23:01 React Native環境でのBuffer問題の修正

### 概要
ユーザーが実際にアプリを使用した際に「Property Buffer doesn't exist」エラーが発生。React Native特有の問題を修正したのだ!

### 問題の原因
React NativeではNode.jsのグローバル変数 `Buffer` が存在しないため、`githubService.ts` 内の `Buffer.from()` 呼び出しでエラーが発生。

### 修正内容

#### 1. パッケージ追加
```bash
npm install buffer
```

#### 2. コード修正
**src/services/githubService.ts**:
```typescript
// 追加
import { Buffer } from 'buffer';
```

明示的に `buffer` パッケージから `Buffer` をインポートすることで、React Native環境でもBase64エンコードが正常に動作するようになったのだ。

### 動作確認
- TypeScriptコンパイルエラーなし
- `Buffer.from(content, 'utf-8').toString('base64')` が正常に動作

### 学び
React Nativeでは、Node.js標準のグローバル変数が利用できないケースがあるため、必要なモジュールは明示的にインポートする必要があるのだ。

### 次のアクション
- ユーザーにアプリ再起動を案内
- 実際の送信テストで動作確認

---

## 09:26 React Navigation起動時のString/Boolean型エラーの解決

### 概要
アプリ起動時に `java.lang.String cannot be cast to java.lang.Boolean` エラーが発生。段階的デバッグにより根本原因を特定し、完全に解決したのだ!

### 問題の症状
- `npm start` でアプリ起動
- Expo Goで読み込むとエラー画面
- スタックトレース: `setProperty (SourceFile:642)` から始まる型変換エラー

### デバッグプロセス

#### Phase 1: 段階的切り分け
最小構成から段階的に機能を追加して、エラー発生箇所を特定:

1. **Step 1: 最小構成** (SafeAreaProvider のみ)
   - 結果: ✅ 成功
   - 「Hello Fragmenta - Minimal Test」表示

2. **Step 2: React Native Paper追加**
   - 結果: ✅ 成功
   - 「Hello Fragmenta - Paper Test」表示

3. **Step 3: React Navigation追加**
   - 結果: ❌ エラー発生
   - 原因が React Navigation にあることを特定

#### Phase 2: 各種修正試行

**試行1: 新アーキテクチャの無効化**
- `app.json` で `newArchEnabled: false` に変更
- Android設定を簡素化(`edgeToEdgeEnabled`, `predictiveBackGestureEnabled` 削除)
- 結果: 効果なし

**試行2: react-native-gesture-handlerの追加**
```bash
npm install react-native-gesture-handler
```
- `index.ts` に `import 'react-native-gesture-handler';` 追加
- 結果: 効果なし

**試行3: react-native-screensのバージョン調整**
- v4.17.1 → v3.31.1 へダウングレード試行
- React Navigation v7との競合で失敗

**試行4: React Navigationのバージョン調整**
```bash
npx expo install @react-navigation/native @react-navigation/bottom-tabs react-native-screens
```
- Expo SDK 54互換バージョンを再インストール
- 結果: 同じエラーが継続

### 根本原因の発見

スタックトレースとエラーパターンから、React Navigation v7の `tabBarIcon` プロパティで渡される `size` が **文字列型** として扱われているが、`@expo/vector-icons` の `MaterialCommunityIcons` は **数値型** を期待していることが判明!

Androidのネイティブコードでは、プロパティが文字列として渡されるケースがあり、それをBoolean型にキャストしようとして失敗していたのだ。

### 最終的な修正

**App.tsx** の全てのアイコンで明示的に `Number()` キャスト:

```typescript
// 修正前
<MaterialCommunityIcons name="home" color={color} size={size} />

// 修正後
<MaterialCommunityIcons name="home" color={color} size={Number(size)} />
```

3箇所すべて(ホーム・履歴・設定)を修正。

### 動作確認
- ✅ アプリ正常起動
- ✅ 3つのタブが表示
- ✅ タブ切り替え動作
- ✅ アイコン正常表示

### クリーンアップ
デバッグ用に作成した以下のファイルを削除:
- `App-step1.tsx`
- `App-step2-backup.tsx`
- `App-step2-backup2.tsx`
- `App-step3-error.tsx`
- `App-test.tsx`
- `App.tsx.backup`

### 技術的な学び

1. **型変換の重要性**: React Native BridgeではJavaScriptとネイティブコード間で型が暗黙的に変換される場合があり、明示的なキャストが必要
2. **段階的デバッグの有効性**: 最小構成から段階的に機能を追加することで、問題箇所を正確に特定できた
3. **エラーメッセージの読み方**: `String cannot be cast to Boolean` は直接的な型エラーではなく、数値として扱うべき文字列が原因だった
4. **バージョン互換性**: Expo SDK 54とReact Navigation v7の組み合わせでは、プロパティの型処理に注意が必要

### 修正ファイル一覧
- `App.tsx`: アイコンの `size` プロパティに `Number()` キャスト追加
- `app.json`: `newArchEnabled: false`, Android設定簡素化
- `index.ts`: `react-native-gesture-handler` インポート追加
- `src/services/githubService.ts`: `Buffer` インポート追加
- パッケージ追加: `buffer`, `react-native-gesture-handler`

### 成果
約2時間のデバッグで、複雑な型エラーを完全に解決し、アプリが正常に動作するようになったのだ!
